/*! Fast Average Color | Â© 2020 Denis Seleznev | MIT License | https://github.com/fast-average-color/fast-average-color */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).FastAverageColor=t()}(this,function(){"use strict";function o(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function t(e){e=e.toString(16);return 1===e.length?"0"+e:e}function i(e){return"#"+e.map(t).join("")}function p(e,t,r){for(var n=0;n<r.length;n++)if(function(e,t,r){switch(r.length){case 3:if(function(e,t,r){return 255!==e[t+3]||e[t]===r[0]&&e[t+1]===r[1]&&e[t+2]===r[2]}(e,t,r))return!0;break;case 4:if(function(e,t,r){if(e[t+3]&&r[3])return e[t]===r[0]&&e[t+1]===r[1]&&e[t+2]===r[2]&&e[t+3]===r[3];return e[t+3]===r[3]}(e,t,r))return!0;break;case 5:if(function(e,t,r){var n=r[0],o=r[1],i=r[2],a=r[3],s=r[4],u=e[t+3],r=c(u,a,s);if(!a)return r;if(!u&&r)return!0;if(c(e[t],n,s)&&c(e[t+1],o,s)&&c(e[t+2],i,s)&&r)return!0;return!1}(e,t,r))return!0;break;default:return!1}}(e,t,r[n]))return 1}function c(e,t,r){return t-r<=e&&e<=t+r}function a(e,t,r){for(var n={},o=r.ignoredColor,i=r.step,a=0;a<t;a+=i){var s,u=e[a],c=e[a+1],h=e[a+2],d=e[a+3];o&&p(e,a,o)||(s=Math.round(u/24)+","+Math.round(c/24)+","+Math.round(h/24),n[s]?n[s]=[n[s][0]+u*d,n[s][1]+c*d,n[s][2]+h*d,n[s][3]+d,n[s][4]+1]:n[s]=[u*d,c*d,h*d,d,1])}var f=Object.keys(n).map(function(e){return n[e]}).sort(function(e,t){e=e[4],t=t[4];return t<e?-1:e===t?0:1})[0],l=f[0],g=f[1],v=f[2],m=f[3],f=f[4];return m?[Math.round(l/m),Math.round(g/m),Math.round(v/m),Math.round(m/f)]:r.defaultColor}function s(e,t,r){for(var n=0,o=0,i=0,a=0,s=0,u=r.ignoredColor,c=r.step,h=0;h<t;h+=c){var d=e[h+3],f=e[h]*d,l=e[h+1]*d,g=e[h+2]*d;u&&p(e,h,u)||(n+=f,o+=l,i+=g,a+=d,s++)}return a?[Math.round(n/a),Math.round(o/a),Math.round(i/a),Math.round(a/s)]:r.defaultColor}function u(e,t,r){for(var n=0,o=0,i=0,a=0,s=0,u=r.ignoredColor,c=r.step,h=0;h<t;h+=c){var d=e[h],f=e[h+1],l=e[h+2],g=e[h+3];u&&p(e,h,u)||(n+=d*d*g,o+=f*f*g,i+=l*l*g,a+=g,s++)}return a?[Math.round(Math.sqrt(n/a)),Math.round(Math.sqrt(o/a)),Math.round(Math.sqrt(i/a)),Math.round(a/s)]:r.defaultColor}function g(e){return v(e,"defaultColor",[0,0,0,0])}function v(e,t,r){return void 0===e[t]?r:e[t]}var n="FastAverageColor: ";function m(e,t,r){e.silent||(console.error(n+t),r&&console.error(r))}function h(e){return Error(n+e)}return function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,r,n;return t=e,(r=[{key:"getColorAsync",value:function(e,t){if(!e)return Promise.reject(h("call .getColorAsync() without resource."));if("string"==typeof e){var r=new Image;return r.crossOrigin="",r.src=e,this._bindImageEvents(r,t)}if(e instanceof Image&&!e.complete)return this._bindImageEvents(e,t);t=this.getColor(e,t);return t.error?Promise.reject(t.error):Promise.resolve(t)}},{key:"getColor",value:function(t,r){var e=g(r=r||{});if(!t)return m(r,"call .getColor(null) without resource."),this.prepareResult(e);var n,o,i,a,s,u,c,h=function(e){if(e instanceof HTMLImageElement){var t=e.naturalWidth,r=e.naturalHeight;return e.naturalWidth||-1===e.src.search(/\.svg(\?|$)/i)||(t=r=100),{width:t,height:r}}return e instanceof HTMLVideoElement?{width:e.videoWidth,height:e.videoHeight}:{width:e.width,height:e.height}}(t),d=(n=h,a=v(o=r,"left",0),s=v(o,"top",0),u=v(o,"width",n.width),c=v(o,"height",n.height),h=u,n=c,"precision"===o.mode||(c<u?(i=u/c,h=100,n=Math.round(h/i)):(i=c/u,n=100,h=Math.round(n/i)),(u<h||c<n||h<10||n<10)&&(h=u,n=c)),{srcLeft:a,srcTop:s,srcWidth:u,srcHeight:c,destWidth:h,destHeight:n});if(!(d.srcWidth&&d.srcHeight&&d.destWidth&&d.destHeight))return m(r,'incorrect sizes for resource "'.concat(t.src,'".')),this.prepareResult(e);if(!this._ctx&&(this._canvas="undefined"==typeof window?new OffscreenCanvas(1,1):document.createElement("canvas"),this._ctx=this._canvas.getContext&&this._canvas.getContext("2d"),!this._ctx))return m(r,"Canvas Context 2D is not supported in this browser."),this.prepareResult(e);this._canvas.width=d.destWidth,this._canvas.height=d.destHeight;var f=e;try{this._ctx.clearRect(0,0,d.destWidth,d.destHeight),this._ctx.drawImage(t,d.srcLeft,d.srcTop,d.srcWidth,d.srcHeight,0,0,d.destWidth,d.destHeight);var l=this._ctx.getImageData(0,0,d.destWidth,d.destHeight).data,f=this.getColorFromArray4(l,r)}catch(e){m(r,"security error (CORS) for resource ".concat(t.src,".\nDetails: https://developer.mozilla.org/en/docs/Web/HTML/CORS_enabled_image"),e)}return this.prepareResult(f)}},{key:"getColorFromArray4",value:function(e,t){t=t||{};var r=e.length,n=g(t);if(r<4)return n;var o,i=r-r%4,r=4*(t.step||1);switch(t.algorithm||"sqrt"){case"simple":o=s;break;case"sqrt":o=u;break;case"dominant":o=a;break;default:throw h("".concat(t.algorithm," is unknown algorithm."))}return o(e,i,{defaultColor:n,ignoredColor:(t=t.ignoredColor)&&(Array.isArray(t)?"number"==typeof t[0]?[t.slice()]:t:[t]),step:r})}},{key:"prepareResult",value:function(e){var t,r=e.slice(0,3),n=[].concat(r,e[3]/255),t=(299*(t=e)[0]+587*t[1]+114*t[2])/1e3<128;return{value:e,rgb:"rgb("+r.join(",")+")",rgba:"rgba("+n.join(",")+")",hex:i(r),hexa:i(e),isDark:t,isLight:!t}}},{key:"destroy",value:function(){delete this._canvas,delete this._ctx}},{key:"_bindImageEvents",value:function(a,s){var u=this;return new Promise(function(t,r){function e(){i();var e=u.getColor(a,s);e.error?r(e.error):t(e)}function n(){i(),r(h('Error loading image "'.concat(a.src,'".')))}function o(){i(),r(h('Image "'.concat(a.src,'" loading aborted.')))}var i=function(){a.removeEventListener("load",e),a.removeEventListener("error",n),a.removeEventListener("abort",o)};a.addEventListener("load",e),a.addEventListener("error",n),a.addEventListener("abort",o)})}}])&&o(t.prototype,r),n&&o(t,n),e}()});